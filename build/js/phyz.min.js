var CollisionData=function(){function t(t,i){this.self={sprite:t,point:new V2(t.x,t.y)},this.other={sprite:i,point:new V2(i.x,i.y)}}return t}(),Collisions=function(){function t(t){this.data=t||[]}return t.prototype.add=function(t){this.get(t.other.sprite)===!1&&(this.data.push(t),t.self.sprite.trigger("collision.begin",t),t.other.sprite.trigger("collision.begin",new CollisionData(t.other.sprite,t.self.sprite)))},t.prototype.remove=function(t){t.self.sprite.trigger("collision.end",t),t.other.sprite.trigger("collision.end",t.other.sprite.collisions.get(t.self.sprite)),this.data.remove(t)},t.prototype.get=function(t){var i;for(i=0;i<this.data.length;i++)if(this.data[i].other.sprite===t)return this.data[i];return!1},t.prototype.clear=function(){this.data=[]},t}(),Collision=function(){function t(){}return t.prototype.check=function(t,i){if(!t instanceof Sprite||!i instanceof Sprite)return!1;var e,s,o,n,r,a=!1,l=new V2(0,0);t.x<=i.x?(e=t,s=i):(e=i,s=t),o=s.x-(e.x+e.width),t.y<=i.y?(e=t,s=i):(e=i,s=t),n=s.y-(e.y+e.height),0>o&&0>n&&(a=!0,l.x=o,l.y=n),a?(r=new CollisionData(t,i),t.sensor||i.sensor?t.collisions.add(r):(!i.config.plataform||i.config.plataform&&t.cache.y<t.cache.y)&&(l.x<l.y?t.y+=l.y:t.x+=l.x,"dynamic"===t.type&&"dynamic"===i.type?this.elastic(r):(this.normal(r),l.x<0&&(t.velocity.x=0),l.y<0&&(t.velocity.y=0)),t.collisions.add(r))):(r=t.collisions.get(i),r&&t.collisions.remove(r))},t.prototype.normal=function(t){var i=t.self.sprite,e=t.other.sprite;e.velocity.x=e.x-e.cache.x,e.velocity.y=e.y-e.cache.y,i.x+=e.velocity.x,i.y+=e.velocity.y},t.prototype.elastic=function(t){var i=t.self.sprite,e=t.other.sprite;i.velocity=new V2((i.velocity.x*(i.mass-e.mass)+2*e.mass*e.velocity.x)/(i.mass+e.mass),(i.velocity.y*(i.mass-e.mass)+2*e.mass*e.velocity.y)/(i.mass+e.mass)),e.velocity=new V2((e.velocity.x*(e.mass-i.mass)+2*i.mass*i.velocity.x)/(e.mass+i.mass),(e.velocity.y*(e.mass-i.mass)+2*i.mass*i.velocity.y)/(e.mass+i.mass))},new t}();
var DisplayObject=function(){function t(){this.container=new createjs.Container,this.parent=null,this.event=null,this.childs=[]}return t.prototype.addChild=function(t){t.parent=this,this.container&&t.container&&this.container.addChild(t.container),this.childs.push(t),this.trigger("add",t),t.trigger("added",this)},t.prototype.removeChild=function(t){this.container&&t.container&&this.container.removeChild(t.container),this.childs.remove(t),this.trigger("remove",t),t.trigger("removed",this)},EventHandler.init(t.prototype),t}(),Sprite=function(){var t=function(t,i){DisplayObject.apply(this),this.type=t||"static",this.sensor=i||!1,this.cache={},this.cache.x=this.x=0,this.cache.y=this.y=0,this.cache.width=this._width=0,this.cache.height=this._height=0,this.velocity=new V2(0,0),this.acceleration=new V2(0,0),this.resistance=new V2(0,0),this.config={minVelocity:new V2(-99999,-99999),maxVelocity:new V2(99999,99999),plataform:!1,collide:!1},this.tiles=[],this.collisions=new Collisions,this.tick=null,this._view=null,this._debug=null,Object.defineProperty(this,"view",{get:function(){return this._view},set:function(t){this._view&&this.container.removeChild(this._view),this._view=t,this.container.addChild(this._view)}}),Object.defineProperty(this,"width",{get:function(){return this._width},set:function(t){this._width=t,Phyz.Settings.DEBUG_DRAW&&this.debugDraw()}}),Object.defineProperty(this,"height",{get:function(){return this._height},set:function(t){this._height=t,Phyz.Settings.DEBUG_DRAW&&this.debugDraw()}})};return t.prototype=new DisplayObject,t.prototype.debugDraw=function(){this._debug||(this._debug=new createjs.Shape,this.container.addChild(this._debug)),this._debug.graphics.c().f("#000000").dr(0,0,this.width,this.height),this._debug.alpha=.5},t.prototype.getGlobalPosition=function(){var t=new V2(this.x,this.y),i=this.parent;return i&&(t.x+=i.getGlobalPosition().x,t.y+=i.getGlobalPosition().y),t},t.prototype.getRoot=function(){var t=this,i=this.parent;return i&&(t=i.getRoot()),t},t.prototype.getTiles=function(){for(var t=this.tiles,i=0;i<this.childs.length;i++)for(var e=0;e<this.childs[i].tiles.length;e++)t.push(this.childs[i].tiles[e]);return t},t.prototype.setCache=function(){this.cache.x=this.x,this.cache.y=this.y,this.cache.width=this.width,this.cache.height=this.height},t}(),Camera=function(){function t(){this.el=null,this.following=null,this.x=0,this.y=0,this._width=0,this._height=0,Object.defineProperty(this,"width",{get:function(){return this._width},set:function(t){this._width=t,this.el.width=this._width}}),Object.defineProperty(this,"height",{get:function(){return this._height},set:function(t){this._height=t,this.el.height=this._height}})}return t.prototype.init=function(t){this.el=t},t}(),Stage=function(){function t(){DisplayObject.apply(this),this.x=0,this.y=0,this.width=0,this.height=0,this.layers={}}return t.prototype=new DisplayObject,t.prototype.addLayer=function(t,i){this.addChild(i),this.layers[t]=i},t.prototype.removeLayer=function(t){this.removeChild(this.layers[t]),delete this.layers[t]},t.prototype.getLayer=function(t){return this.layers[t]},t}(),Paralax=function(){function t(t,i){var e=image.width+Phyz.Camera.size.width,h=image.height;this.container=new createjs.Container,this.view=new createjs.Shape,this.view.graphics.clear().beginBitmapFill(image,"repeat").drawRect(0,0,e,h),container.addChild(this.view),this.x=0,this.y=0,this.factor=i,this.view.width=t.image.width,this.view.height=h}return t}(),Layer=function(){function t(){DisplayObject.apply(this)}return t.prototype=new DisplayObject,t}();
var EventHandler=function(){var t=function(t){this.context=t,this.events={}};return t.prototype.on=function(t,e){this.events[t]?this.events[t].push(e):this.events[t]=[e]},t.prototype.trigger=function(t,e){if(this.events[t])for(var n=0;n<this.events[t].length;n++)this.events[t][n].apply(this.context,[e||null])},{init:function(e){e.on=function(e,n){this.event||(this.event=new t(this)),this.event.on(e,n)},e.trigger=function(e,n,i){this.event||(this.event=new t(this)),this.event.trigger(e,n),i&&this.parent&&this.parent.trigger(e,n)}}}}();
require(["./Utils","./EventHandler","./DisplayObjects","./CollissionObjects","./Preloader","./TiledIndex","./Tween"],function(e,t,a,i,n,o){var c=[],r=null,y=function(e){var t,a,i,n,o,r,y,l,x=c;for(r=0;r<x.length;r++)if(t=x[r],t.setCache(),"dynamic"===t.type){for(a=new V2((m.Physics.acceleration.x+t.acceleration.x)*e,(m.Physics.acceleration.y+t.acceleration.y)*e),i=new V2((m.Physics.resistance.x+t.resistance.x)*e,(m.Physics.resistance.y+t.resistance.y)*e),t.velocity.add(a),Math.abs(t.velocity.x)>i.x?t.velocity.x+=t.velocity.x>0?-i.x:i.x:t.velocity.x=0,Math.abs(t.velocity.y)>i.y?t.velocity.y+=t.velocity.y>0?-i.y:i.y:t.velocity.y=0,t.velocity.x=t.velocity.x<t.config.minVelocity.x?t.config.minVelocity.x:t.velocity.x,t.velocity.y=t.velocity.y<t.config.minVelocity.y?t.config.minVelocity.y:t.velocity.y,t.velocity.x=t.velocity.x>t.config.maxVelocity.x?t.config.maxVelocity.x:t.velocity.x,t.velocity.y=t.velocity.y>t.config.maxVelocity.y?t.config.maxVelocity.y:t.velocity.y,t.y+=t.velocity.y*e,t.x+=t.velocity.x*e,n=m.TiledIndex.getOthers(t),y=0;y<x.length;y++)o=x[y],t!==o&&Collision.check(t,o);t.tick&&t.tick(e)}m.Camera.following&&(l=new V2(m.Stage.width-m.Camera.width,m.Stage.height-m.Camera.height),m.Camera.x=m.Camera.following.x+m.Camera.following.width/2-m.Camera.width/2,m.Camera.y=m.Camera.following.y+m.Camera.following.height/2-m.Camera.height/2,m.Camera.x<0?m.Camera.x=0:m.Camera.x>l.x&&(m.Camera.x=l.x),m.Camera.y<0?m.Camera.y=0:m.Camera.y>l.y&&(m.Camera.y=l.y)),m.Stage.x=-m.Camera.x,m.Stage.y=-m.Camera.y},l=function(){var e,t;for(t=0;t<c.length;t++)e=c[t],e.container.x=Math.round(e.x),e.container.y=Math.round(e.y);m.Stage.container.x=Math.round(m.Stage.x),m.Stage.container.y=Math.round(m.Stage.y),r.update()},m={Settings:{DEBUG_DRAW:!0},Physics:{acceleration:new V2(0,800),resistance:new V2(0,200)},TiledIndex:null,Stage:new Stage,Camera:new Camera,Preloader:new n,Entity:{},paused:!1,start:function(){var e,t=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},a=function(){e=t(),n+=Math.min(1,(e-c)/1e3),i=Math.min(1,(e-c)/1e3),y(i),l(),c=e,x&&x.tick(),requestAnimationFrame(a)},i=0,n=0,c=t(),x=m.Settings.DEBUG_DRAW?new FPSMeter({decimals:0,graph:!0,theme:"dark",heat:!0,left:"auto",top:"5px",right:"5px",bottom:"auto"}):null;this.TiledIndex=new o,r=new createjs.Stage(this.Camera.el),r.addChild(this.Stage.container),x&&x.tickStart(),requestAnimationFrame(a)},remove:function(e){c=Arr.remove(c,e),this.Stage.getLayer("main").removeChild(e)},add:function(e){c.push(e),this.Stage.getLayer("main").addChild(e)},get sprites(){return c}};return t.init(m),m.Stage.addLayer("main",new Layer),m});
var Preloader=function(){function e(){this.order=[],this.queue={},this.loaded={},this.index=0}return EventHandler.init(e.prototype),e.prototype.get=function(e){return this.loaded[e]?this.loaded[e]:!1},e.prototype.add=function(e,t){"undefined"==typeof this.queue[e]&&"undefined"==typeof this.loaded[e]&&(this.order.push(e),this.queue[e]=t,this.trigger("add"))},e.prototype.clear=function(){this.order=[],this.queue={},this.index=0,this.trigger("clear")},e.prototype.next=function(){if(this.order.length>this.index){var e=this,t=new Image,i=this.index++,r=this.queue[this.order[i]];t.onload=function(){e.loaded[e.order[i]]=this,e.trigger("itemComplete",{order:i,filename:r,progress:i/e.order.length}),e.next()},t.src=r}else this.trigger("complete")},e.prototype.start=function(){this.trigger("start"),this.next()},e}();
var TiledIndex=function(){function t(){if(this.indexes=[],this.limitX=0,this.limitY=0,this.limit=0,this.width=200,this.height=200,this.limitX=~~(Phyz.Stage.width/this.width),this.width=Math.ceil(Phyz.Stage.width/this.limitX),this.limitY=~~(Phyz.Stage.height/this.height),this.height=Math.ceil(Phyz.Stage.height/this.limitY),this.limit=this.limitX*this.limitY,Phyz.Settings.DEBUG_DRAW)for(var t,i=0;i<this.limit;i++)t=i+1,t=100>t?10>t?"00"+t:"0"+t:t}return t.prototype.add=function(t){var i=0,h=t.width/this.width,e=t.height/this.height,s=t.getPositionForCollision(),l=Math.ceil((s.x-t.width/2)/this.width),n=Math.ceil((s.y-t.height/2)/this.height),o=(s.x-t.width/2)%this.width,r=(s.y-t.height/2)%this.height;h=1+(0===o||o>this.width-t.width%this.width-1?Math.ceil(h):Math.floor(h)),e=1+(0===r||r>this.height-t.height%this.height-1?Math.ceil(e):Math.floor(e)),this.remove(t);for(var d=0;h>d;d++)for(var g=0;e>g;g++)i=(n+g-1)*this.limitX+l+d,t.tiles.push(i),"undefined"==typeof this.indexes[i]&&(this.indexes[i]=[]),this.indexes[i].push(t)},t.prototype.remove=function(t){for(var i=0;i<t.tiles.length;i++)this.indexes[t.tiles[i]].remove(t);t.tiles=[]},t.prototype.getOthers=function(t){for(var i,h=[],e=t.getTiles(),s=0;s<e.length;s++){i=this.indexes[e[s]];for(var l=0;l<i.length;l++)-1==h.indexOf(i)&&i[l].getLastParent()!=t.getLastParent()&&h.push(i[l])}return h},t}();

var Device={isStandAlone:"standalone"in window.navigator&&window.navigator.standalone===!0,isRetinaDisplay:2===window.devicePixelRatio,get isPortrait(){return 0===window.orientation||180===window.orientation},get isTablet(){return window.innerWidth>480},isAndroid:/android/gi.test(navigator.appVersion),isIDevice:/iphone|ipad/gi.test(navigator.appVersion),isTouchPad:/hp-tablet/gi.test(navigator.appVersion)},Events={RESIZE:"onorientationchange"in window?"orientationchange":"resize",START:"ontouchstart"in window?"touchstart":"mousedown",MOVE:"ontouchstart"in window?"touchmove":"mousemove",END:"ontouchstart"in window?"touchend":"mouseup",CANCEL:"ontouchstart"in window?"touchcancel":"mouseup",CLICK:"ontap"in window?"tap":"click"};String.prototype.toNumber=function(){return Number(this.replace("px",""))},Array.prototype.indexOf||(Array.prototype.indexOf=function(t,i){i=i||0;for(var n=this.length;n>i;){if(this[i]===t)return i;++i}return-1}),Array.prototype.remove=function(){for(var t,i,n=arguments,o=n.length;o&&this.length;)for(t=n[--o];-1!==(i=this.indexOf(t));)this.splice(i,1);return this};var Arr={remove:function(t,i){for(var n=[],o=0;o<t.length;o++)t[o]!=i&&n.push(t[o]);return n},merge:function(){for(var t=[],i=0;i<arguments.length;i++)for(var n=arguments[i],o=0;o<n.length;o++)-1===t.indexOf(n[o])&&t.push(n[o]);return t}},V2=function(t,i){this.x=Number(t||0),this.y=Number(i||0)};V2.prototype.toString=function(){return"["+this.x+", "+this.y+"]"},V2.prototype.clone=function(){return new V2(this.x,this.y)},V2.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},V2.prototype.perp=function(){var t=this.x;return this.x=this.y,this.y=-t,this},V2.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},V2.prototype.normalize=function(){var t=this.len();return t>0&&(this.x=this.x/t,this.y=this.y/t),this},V2.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},V2.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},V2.prototype.scale=function(t,i){return this.x*=t,this.y*=i||t,this},V2.prototype.project=function(t){var i=this.dot(t)/t.len2();return this.x=i*t.x,this.y=i*t.y,this},V2.prototype.projectN=function(t){var i=this.dot(t);return this.x=i*t.x,this.y=i*t.y,this},V2.prototype.reflect=function(t){var i=this.x,n=this.y;return this.project(t).scale(2),this.x-=i,this.y-=n,this},V2.prototype.reflectN=function(t){var i=this.x,n=this.y;return this.projectN(t).scale(2),this.x-=i,this.y-=n,this},V2.prototype.dot=function(t){return this.x*t.x+this.y*t.y},V2.prototype.len2=function(){return this.dot(this)},V2.prototype.len=function(){return Math.sqrt(this.len2())};