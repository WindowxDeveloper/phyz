var CollisionData=function(){function t(t,i){this.self={sprite:t,point:new V2(t.x,t.y)},this.other={sprite:i,point:new V2(i.x,i.y)}}return t}(),Collisions=function(){function t(t){this.data=t||[]}return t.prototype.add=function(t){this.get(t.other.sprite)===!1&&(this.data.push(t),t.self.sprite.trigger("collision.begin",t),t.other.sprite.trigger("collision.begin",new CollisionData(t.other.sprite,t.self.sprite)))},t.prototype.remove=function(t){t.self.sprite.trigger("collision.end",t),t.other.sprite.trigger("collision.end",t.other.sprite.collisions.get(t.self.sprite)),this.data.remove(t)},t.prototype.get=function(t){var i;for(i=0;i<this.data.length;i++)if(this.data[i].other.sprite===t)return this.data[i];return!1},t.prototype.clear=function(){this.data=[]},t}(),Collision=function(){function t(){}return t.prototype.check=function(t,i){if(!t instanceof Sprite||!i instanceof Sprite)return!1;var e,s,o,n,r,a=!1,l=new V2(0,0);t.x<=i.x?(e=t,s=i):(e=i,s=t),o=s.x-(e.x+e.width),t.y<=i.y?(e=t,s=i):(e=i,s=t),n=s.y-(e.y+e.height),0>o&&0>n&&(a=!0,l.x=o,l.y=n),a?(r=new CollisionData(t,i),t.sensor||i.sensor?t.collisions.add(r):(!i.config.plataform||i.config.plataform&&t.cache.y<t.cache.y)&&(l.x<l.y?t.y+=l.y:t.x+=l.x,"dynamic"===t.type&&"dynamic"===i.type?this.elastic(r):(this.normal(r),l.x<0&&(t.velocity.x=0),l.y<0&&(t.velocity.y=0)),t.collisions.add(r))):(r=t.collisions.get(i),r&&t.collisions.remove(r))},t.prototype.normal=function(t){var i=t.self.sprite,e=t.other.sprite;e.velocity.x=e.x-e.cache.x,e.velocity.y=e.y-e.cache.y,i.x+=e.velocity.x,i.y+=e.velocity.y},t.prototype.elastic=function(t){var i=t.self.sprite,e=t.other.sprite;i.velocity=new V2((i.velocity.x*(i.mass-e.mass)+2*e.mass*e.velocity.x)/(i.mass+e.mass),(i.velocity.y*(i.mass-e.mass)+2*e.mass*e.velocity.y)/(i.mass+e.mass)),e.velocity=new V2((e.velocity.x*(e.mass-i.mass)+2*i.mass*i.velocity.x)/(e.mass+i.mass),(e.velocity.y*(e.mass-i.mass)+2*i.mass*i.velocity.y)/(e.mass+i.mass))},new t}();
var DisplayObject=function(){function t(){this.container=new createjs.Container,this.parent=null,this.event=null,this.childs=[]}return t.prototype.addChild=function(t){t.parent=this,this.container&&t.container&&this.container.addChild(t.container),this.childs.push(t),this.trigger("add",t),t.trigger("added",this)},t.prototype.removeChild=function(t){this.container&&t.container&&this.container.removeChild(t.container),this.childs.remove(t),this.trigger("remove",t),t.trigger("removed",this)},EventHandler.init(t.prototype),t}(),Sprite=function(){var t=function(t,i){DisplayObject.apply(this),this.type=t||"static",this.sensor=i||!1,this.cache={},this.cache.x=this.x=0,this.cache.y=this.y=0,this.cache.width=this._width=0,this.cache.height=this._height=0,this.velocity=new V2(0,0),this.acceleration=new V2(0,0),this.resistance=new V2(0,0),this.config={minVelocity:new V2(-99999,-99999),maxVelocity:new V2(99999,99999),plataform:!1,collide:!1},this.tiles=[],this.collisions=new Collisions,this.tick=null,this._view=null,this._debug=null,Object.defineProperty(this,"view",{get:function(){return this._view},set:function(t){this._view&&this.container.removeChild(this._view),this._view=t,this.container.addChild(this._view)}}),Object.defineProperty(this,"width",{get:function(){return this._width},set:function(t){this._width=t,Engine.Settings.DEBUG_DRAW&&this.debugDraw()}}),Object.defineProperty(this,"height",{get:function(){return this._height},set:function(t){this._height=t,Engine.Settings.DEBUG_DRAW&&this.debugDraw()}})};return t.prototype=new DisplayObject,t.prototype.debugDraw=function(){this._debug||(this._debug=new createjs.Shape,this.container.addChild(this._debug)),this._debug.graphics.c().f("#000000").dr(0,0,this.width,this.height),this._debug.alpha=.5},t.prototype.getGlobalPosition=function(){var t=new V2(this.x,this.y),i=this.parent;return i&&(t.x+=i.getGlobalPosition().x,t.y+=i.getGlobalPosition().y),t},t.prototype.getRoot=function(){var t=this,i=this.parent;return i&&(t=i.getRoot()),t},t.prototype.getTiles=function(){for(var t=this.tiles,i=0;i<this.childs.length;i++)for(var e=0;e<this.childs[i].tiles.length;e++)t.push(this.childs[i].tiles[e]);return t},t.prototype.setCache=function(){this.cache.x=this.x,this.cache.y=this.y,this.cache.width=this.width,this.cache.height=this.height},t}(),Camera=function(){function t(){this.el=null,this.following=null,this.x=0,this.y=0,this._width=0,this._height=0,Object.defineProperty(this,"width",{get:function(){return this._width},set:function(t){this._width=t,this.el.width=this._width}}),Object.defineProperty(this,"height",{get:function(){return this._height},set:function(t){this._height=t,this.el.height=this._height}})}return t.prototype.init=function(t){this.el=t},t}(),Stage=function(){function t(){DisplayObject.apply(this),this.x=0,this.y=0,this.width=0,this.height=0,this.layers={}}return t.prototype=new DisplayObject,t.prototype.addLayer=function(t,i){this.addChild(i),this.layers[t]=i},t.prototype.removeLayer=function(t){this.removeChild(this.layers[t]),delete this.layers[t]},t.prototype.getLayer=function(t){return this.layers[t]},t}(),Paralax=function(){function t(t,i){var e=image.width+Engine.Camera.size.width,h=image.height;this.container=new createjs.Container,this.view=new createjs.Shape,this.view.graphics.clear().beginBitmapFill(image,"repeat").drawRect(0,0,e,h),container.addChild(this.view),this.x=0,this.y=0,this.factor=i,this.view.width=t.image.width,this.view.height=h}return t}(),Layer=function(){function t(){DisplayObject.apply(this)}return t.prototype=new DisplayObject,t}();
var Engine=function(){var e=[],t=null,a=function(t){var a,i,o,r,c,y,l,m,x=e;for(y=0;y<x.length;y++)if(a=x[y],a.setCache(),"dynamic"===a.type){for(i=new V2((n.Physics.acceleration.x+a.acceleration.x)*t,(n.Physics.acceleration.y+a.acceleration.y)*t),o=new V2((n.Physics.resistance.x+a.resistance.x)*t,(n.Physics.resistance.y+a.resistance.y)*t),a.velocity.add(i),Math.abs(a.velocity.x)>o.x?a.velocity.x+=a.velocity.x>0?-o.x:o.x:a.velocity.x=0,Math.abs(a.velocity.y)>o.y?a.velocity.y+=a.velocity.y>0?-o.y:o.y:a.velocity.y=0,a.velocity.x=a.velocity.x<a.config.minVelocity.x?a.config.minVelocity.x:a.velocity.x,a.velocity.y=a.velocity.y<a.config.minVelocity.y?a.config.minVelocity.y:a.velocity.y,a.velocity.x=a.velocity.x>a.config.maxVelocity.x?a.config.maxVelocity.x:a.velocity.x,a.velocity.y=a.velocity.y>a.config.maxVelocity.y?a.config.maxVelocity.y:a.velocity.y,a.y+=a.velocity.y*t,a.x+=a.velocity.x*t,r=n.TiledIndex.getOthers(a),l=0;l<x.length;l++)c=x[l],a!==c&&Collision.check(a,c);a.tick&&a.tick(t)}n.Camera.following&&(m=new V2(n.Stage.width-n.Camera.width,n.Stage.height-n.Camera.height),n.Camera.x=n.Camera.following.x+n.Camera.following.width/2-n.Camera.width/2,n.Camera.y=n.Camera.following.y+n.Camera.following.height/2-n.Camera.height/2,n.Camera.x<0?n.Camera.x=0:n.Camera.x>m.x&&(n.Camera.x=m.x),n.Camera.y<0?n.Camera.y=0:n.Camera.y>m.y&&(n.Camera.y=m.y)),n.Stage.x=-n.Camera.x,n.Stage.y=-n.Camera.y},i=function(){var a,i;for(i=0;i<e.length;i++)a=e[i],a.container.x=Math.round(a.x),a.container.y=Math.round(a.y);n.Stage.container.x=Math.round(n.Stage.x),n.Stage.container.y=Math.round(n.Stage.y),t.update()},n={Settings:{DEBUG_DRAW:!0},Physics:{acceleration:new V2(0,800),resistance:new V2(0,200)},TiledIndex:null,Stage:new Stage,Camera:new Camera,Preloader:new Preloader,Entity:{},paused:!1,start:function(){var e,o=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},r=function(){e=o(),y+=Math.min(1,(e-l)/1e3),c=Math.min(1,(e-l)/1e3),a(c),i(),l=e,m&&m.tick(),requestAnimationFrame(r)},c=0,y=0,l=o(),m=n.Settings.DEBUG_DRAW?new FPSMeter({decimals:0,graph:!0,theme:"dark",heat:!0,left:"auto",top:"5px",right:"5px",bottom:"auto"}):null;this.TiledIndex=new TiledIndex,t=new createjs.Stage(this.Camera.el),t.addChild(this.Stage.container),m&&m.tickStart(),requestAnimationFrame(r)},remove:function(t){e=Arr.remove(e,t),this.Stage.getLayer("main").removeChild(t)},add:function(t){e.push(t),this.Stage.getLayer("main").addChild(t)},get sprites(){return e}};return EventHandler.init(n),n.Stage.addLayer("main",new Layer),n}();
var EventHandler=function(){var t=function(t){this.context=t,this.events={}};return t.prototype.on=function(t,e){this.events[t]?this.events[t].push(e):this.events[t]=[e]},t.prototype.trigger=function(t,e){if(this.events[t])for(var n=0;n<this.events[t].length;n++)this.events[t][n].apply(this.context,[e||null])},{init:function(e){e.on=function(e,n){this.event||(this.event=new t(this)),this.event.on(e,n)},e.trigger=function(e,n,i){this.event||(this.event=new t(this)),this.event.trigger(e,n),i&&this.parent&&this.parent.trigger(e,n)}}}}();
var Preloader=function(){function e(){this.order=[],this.queue={},this.loaded={},this.index=0}return EventHandler.init(e.prototype),e.prototype.get=function(e){return this.loaded[e]?this.loaded[e]:!1},e.prototype.add=function(e,t){"undefined"==typeof this.queue[e]&&"undefined"==typeof this.loaded[e]&&(this.order.push(e),this.queue[e]=t,this.trigger("add"))},e.prototype.clear=function(){this.order=[],this.queue={},this.index=0,this.trigger("clear")},e.prototype.next=function(){if(this.order.length>this.index){var e=this,t=new Image,i=this.index++,r=this.queue[this.order[i]];t.onload=function(){e.loaded[e.order[i]]=this,e.trigger("itemComplete",{order:i,filename:r,progress:i/e.order.length}),e.next()},t.src=r}else this.trigger("complete")},e.prototype.start=function(){this.trigger("start"),this.next()},e}();
var TiledIndex=function(){function i(){if(this.indexes=[],this.limitX=0,this.limitY=0,this.limit=0,this.width=200,this.height=200,this.limitX=~~(Engine.Stage.width/this.width),this.width=Math.ceil(Engine.Stage.width/this.limitX),this.limitY=~~(Engine.Stage.height/this.height),this.height=Math.ceil(Engine.Stage.height/this.limitY),this.limit=this.limitX*this.limitY,Engine.Settings.DEBUG_DRAW)for(var i,t=0;t<this.limit;t++)i=t+1,i=100>i?10>i?"00"+i:"0"+i:i}return i.prototype.add=function(i){var t=0,h=i.width/this.width,e=i.height/this.height,s=i.getPositionForCollision(),n=Math.ceil((s.x-i.width/2)/this.width),g=Math.ceil((s.y-i.height/2)/this.height),l=(s.x-i.width/2)%this.width,o=(s.y-i.height/2)%this.height;h=1+(0===l||l>this.width-i.width%this.width-1?Math.ceil(h):Math.floor(h)),e=1+(0===o||o>this.height-i.height%this.height-1?Math.ceil(e):Math.floor(e)),this.remove(i);for(var r=0;h>r;r++)for(var d=0;e>d;d++)t=(g+d-1)*this.limitX+n+r,i.tiles.push(t),"undefined"==typeof this.indexes[t]&&(this.indexes[t]=[]),this.indexes[t].push(i)},i.prototype.remove=function(i){for(var t=0;t<i.tiles.length;t++)this.indexes[i.tiles[t]].remove(i);i.tiles=[]},i.prototype.getOthers=function(i){for(var t,h=[],e=i.getTiles(),s=0;s<e.length;s++){t=this.indexes[e[s]];for(var n=0;n<t.length;n++)-1==h.indexOf(t)&&t[n].getLastParent()!=i.getLastParent()&&h.push(t[n])}return h},i}();

var Device={isStandAlone:"standalone"in window.navigator&&window.navigator.standalone===!0,isRetinaDisplay:2===window.devicePixelRatio,get isPortrait(){return 0===window.orientation||180===window.orientation},get isTablet(){return window.innerWidth>480},isAndroid:/android/gi.test(navigator.appVersion),isIDevice:/iphone|ipad/gi.test(navigator.appVersion),isTouchPad:/hp-tablet/gi.test(navigator.appVersion)},Events={RESIZE:"onorientationchange"in window?"orientationchange":"resize",START:"ontouchstart"in window?"touchstart":"mousedown",MOVE:"ontouchstart"in window?"touchmove":"mousemove",END:"ontouchstart"in window?"touchend":"mouseup",CANCEL:"ontouchstart"in window?"touchcancel":"mouseup",CLICK:"ontap"in window?"tap":"click"};String.prototype.toNumber=function(){return Number(this.replace("px",""))},Array.prototype.indexOf||(Array.prototype.indexOf=function(n,t){t=t||0;for(var o=this.length;o>t;){if(this[t]===n)return t;++t}return-1}),Array.prototype.remove=function(){for(var n,t,o=arguments,e=o.length;e&&this.length;)for(n=o[--e];-1!==(t=this.indexOf(n));)this.splice(t,1);return this};var Arr={remove:function(n,t){for(var o=[],e=0;e<n.length;e++)n[e]!=t&&o.push(n[e]);return o},merge:function(){for(var n=[],t=0;t<arguments.length;t++)for(var o=arguments[t],e=0;e<o.length;e++)-1===n.indexOf(o[e])&&n.push(o[e]);return n}};
var V2=function(t,i){this.x=Number(t||0),this.y=Number(i||0)};V2.prototype.toString=function(){return"["+this.x+", "+this.y+"]"},V2.prototype.clone=function(){return new V2(this.x,this.y)},V2.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},V2.prototype.perp=function(){var t=this.x;return this.x=this.y,this.y=-t,this},V2.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},V2.prototype.normalize=function(){var t=this.len();return t>0&&(this.x=this.x/t,this.y=this.y/t),this},V2.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},V2.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},V2.prototype.scale=function(t,i){return this.x*=t,this.y*=i||t,this},V2.prototype.project=function(t){var i=this.dot(t)/t.len2();return this.x=i*t.x,this.y=i*t.y,this},V2.prototype.projectN=function(t){var i=this.dot(t);return this.x=i*t.x,this.y=i*t.y,this},V2.prototype.reflect=function(t){var i=this.x,r=this.y;return this.project(t).scale(2),this.x-=i,this.y-=r,this},V2.prototype.reflectN=function(t){var i=this.x,r=this.y;return this.projectN(t).scale(2),this.x-=i,this.y-=r,this},V2.prototype.dot=function(t){return this.x*t.x+this.y*t.y},V2.prototype.len2=function(){return this.dot(this)},V2.prototype.len=function(){return Math.sqrt(this.len2())};